---
title: "strings_rverbal"
author: "Peter Higgins"
date: "10/9/2019"
output: html_document
---



## More complex string manipulation
Working with real clinical text can be quite complex, as you deconstruct pieces of clinical documents. We will work up to examples of pathology report text blobs, and extracting useful pieces of information from these.

### Getting Started
Let's review some of our previous work, starting with *stringr* and _str_view_  vs. _str_detect_


** note str_view to start, then str_detect**

In the code chunk below, you have a string vector object called example_vec,
which is a character (string) vector of colors.
We are trying to find out which ones are gray.
A text pattern is assigned to the object `pattern`
then use str_detect(string = , pattern = pattern) to detect it.
Use example_vec as your string to replace the placeholder `var`.


```r
example_vec <- c("gray", "blue", "steel blue", "Gray blue", "grey", "cloudy gray", "Rainy Gray", "smoky blue")
pattern <- "gray"
str_view(string = example_vec, pattern = pattern)
```

```
## PhantomJS not found. You can install it with webshot::install_phantomjs(). If it is installed, please make sure the phantomjs executable can be found via the PATH variable.
```

<!--html_preserve--><div id="htmlwidget-0a73cff47dac544159a7" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-0a73cff47dac544159a7">{"x":{"html":"<ul>\n  <li><span class='match'>gray<\/span><\/li>\n  <li>blue<\/li>\n  <li>steel blue<\/li>\n  <li>Gray blue<\/li>\n  <li>grey<\/li>\n  <li>cloudy <span class='match'>gray<\/span><\/li>\n  <li>Rainy Gray<\/li>\n  <li>smoky blue<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script><!--/html_preserve-->
Go ahead and check these.
You will see that the color `grey` was not recognized, as it is not an exact match. Apparently a British person was supplying this color. 
Later on, we will work on how to capture variants like this.

### Finding inflammation
Below, you have a string vector object called str_vec.
Your task is to write the code to detect instances of the word "inflammation".
Assign a text string to the object `pattern`
then use str_detect(string = , pattern = pattern) to detect it.
Replace the placeholder `var` with str_vec


```r
str_vec <- c("chronic inflammtion", "neutrophils in lamina propria", "acutely inflamed", "no evidence of inflammation", "lymphocytes and plasma cells indicating inflammation", "acutely inflamed with neutrophil crypt abscesses", "chronic inflammation with distortion of crypts", "active on chronic inflammation")

pattern <- 

str_detect(string = var, pattern = pattern)
```
Go ahead and check these manually.
You will see that you don't pick up variants like "inflamed"
and that you get false positives from negated statements like 
"no evidence of inflammation".
Real clinical text is challenging, and requires good tools and some careful pattern creation.

### The Mystery of Regex and the Beauty of RVerbalExpressions

REGular EXpressions, or regex, is a common approach to produce more complex string matching. It allows you to specify wild cards, numbers of repeated characters, white space, digits, etc. This is great, but it can be rather complex, and lead to pretty complicated and obscure pattern expressions.

For example, this is the regex pattern to match a US phone number:

`/^(1\s?)?((\([0-9]{3}\))|[0-9]{3})[\s\-]?[\0-9]{3}[\s\-]?[0-9]{4}$/g`

to make this more manageable for beginners, we will use the 
*RVerbalExpressions* package.

Let's start with some simple _str_detect_.
Predict the outcome (TRUE/FALSE) of each of the examples below, then run the code chunk.


```r
str_detect(string = "cat", pattern = "c")
```

```
## [1] TRUE
```

```r
str_detect(string = "grey", pattern = "gr")
```

```
## [1] TRUE
```

```r
str_detect(string = c("grey", "Gray"), pattern = "gr")
```

```
## [1]  TRUE FALSE
```

```r
str_detect(string = c("grey", "gray"), pattern = "gr")
```

```
## [1] TRUE TRUE
```

```r
str_detect(string = c("grey", "gray"), pattern = "gray")
```

```
## [1] FALSE  TRUE
```

You can see that the `grey` spelling variant is making this more difficult.
We can make this work using more complex patterns.
The RVerbalExpressions package can help us build these.

Take about 10 minutes to explore the webpage for
[RVerbalExpressions](https://rverbalexpressions.netlify.com/)
Look at the home page, the Examples Article,
and the Reference page for all of the functions.

### Your First RVE

We are going to build a regex pattern that will match both `grey` and `Gray`.

Then we will run a str_detect with this pattern.
The pattern starts with `rx_start_of_line()`
to begin at the beginning of a word.
Then `rx_find()` - fill in the text that is constant at the beginning of both gray and grey.
Then `rx_any_of(" ")`  - fill in the two possible vowels, as in "oi"
then `rx_find(' ')` again - fill in the constant letters at the end of gray and gray here

Now replace the pattern argument in str_detect with your pattern object


```r
example_vec
```

```
## [1] "gray"        "blue"        "steel blue"  "Gray blue"  
## [5] "grey"        "cloudy gray" "Rainy Gray"  "smoky blue"
```

```r
pattern <- rx() %>% 
  rx_find('gr') %>% 
  rx_any_of('ae') %>% 
  rx_find('y') 
pattern
```

```
## [1] "(gr)[ae](y)"
```

```r
str_detect(string = example_vec, pattern = pattern)
```

```
## [1]  TRUE FALSE FALSE FALSE  TRUE  TRUE FALSE FALSE
```

### Now an RVE with medical data
- pathology output


```r
str_vec <- c("chronic inflammtion", "neutrophils in lamina propria", "acutely inflamed", "no evidence of inflammation", "lymphocytes and plasma cells indicating inflammation", "acutely inflamed with neutrophil crypt abscesses", "chronic inflammation with distortion of crypts", "active on chronic inflammation")

pattern <- "inflam|neutrophil"

str_view(string = str_vec, pattern = pattern)
```

<!--html_preserve--><div id="htmlwidget-6b0a5ca15b8ad08090e5" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-6b0a5ca15b8ad08090e5">{"x":{"html":"<ul>\n  <li>chronic <span class='match'>inflam<\/span>mtion<\/li>\n  <li><span class='match'>neutrophil<\/span>s in lamina propria<\/li>\n  <li>acutely <span class='match'>inflam<\/span>ed<\/li>\n  <li>no evidence of <span class='match'>inflam<\/span>mation<\/li>\n  <li>lymphocytes and plasma cells indicating <span class='match'>inflam<\/span>mation<\/li>\n  <li>acutely <span class='match'>inflam<\/span>ed with neutrophil crypt abscesses<\/li>\n  <li>chronic <span class='match'>inflam<\/span>mation with distortion of crypts<\/li>\n  <li>active on chronic <span class='match'>inflam<\/span>mation<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script><!--/html_preserve-->



```r
pattern1  <- rx() %>% 
  rx_seek_prefix("Diagnosis: ") %>% 
  rx_anything() %>% 
  rx_seek_suffix("Signing Pathologist:") 

# if you need more than one pattern with 'OR' logic
# p <- glue(pattern, "|", pattern2,  "|", pattern3)

str_extract(string = path$text, pattern = pattern1)
```

```
##   [1] "A. Rectum, biopsy: Quiescent ulcerative colitis. Negative for dysplasia.     "                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
##   [2] "A. Distal transverse colon, biopsy: No significant abnormality. Negative for dysplasia. Negative for virocytes.   B-C. Left and rectosigmoid colon, biopsies: Patchy active ulcerative colitis. Negative for dysplasia. Negative for virocytes.     "                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
##   [3] "A. Terminal ileum, biopsies: - Unremarkable ileal mucosa. B. Cecum, biopsies: -  Diffuse, mildly active chronic colitis. C. Ascending colon, biopsies: -  Diffuse, mildly active chronic colitis. D. Transverse colon, biopsies: -  Diffuse, mildly active chronic colitis. E. Descending colon, biopsies: - Very mild chronic changes without activity. F. Sigmoid colon, biopsies: - Very mild chronic changes without activity. G. Rectum, biopsies: - Patchy, moderately active chronic colitis.     "                                                                                                                                                                                                                                     
##   [4] "A-D. Right colon through rectum, pancolonic biopsies: Mildly active ulcerative pancolitis. Negative for dysplasia.     "                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
##   [5] "A-F. Right colon through rectum, surveillance biopsies: No significant abnormality. Negative for dysplasia.     "                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
##   [6] "A. Terminal ileum, biopsies: - Unremarkable ileal mucosa.     B-G, K. Cecum, 100 cm, 90 cm, 90 cm polyp, 80 cm, 70 cm, 30 cm, biopsies: - Diffuse, moderately active chronic colitis with inflammatory polyp formation, no dysplasia seen.     H-J, L- M. 60 cm, 50 cm, 40 cm, 20 cm, 10 cm, biopsies: - Diffuse, mildly active chronic colitis, no dysplasia seen.     "                                                                                                                                                                                                                                                                                                                                                                      
##   [7] "A-G. Colon, surveillance biopsies: Quiescent ulcerative pancolitis. Polypoid low-grade dysplasia identical to a sporadic adenoma at 48 cm. Otherwise, no dysplasia.     "                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
##   [8] "A. Esophagus, biopsy: Squamous and columnar mucosa with no significant abnormality. Negative for intestinal metaplasia or dysplasia.   B-E. Colon, surveillance biopsies: No significant abnormality. Negative for dysplasia.     "                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
##   [9] "A. Colon, rectosigmoid, biopsy:  No significant abnormality.     "                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
##  [10] "A. Stomach, biopsy: No significant abnormality.   F. Sigmoid colon, biopsy: Adenoma.   B-D and G. Ascending colon through rectum, surveillance biopsies: No significant abnormality. Negative for dysplasia.     "                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
##  [11] "A. Rectal stump, biopsy: Chronic colitis, probably a combination of ulcerative colitis and diversion colitis. Negative for dysplasia.     "                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
##  [12] "A. Terminal ileum, biopsy: No significant abnormality.   B-G. Right colon through rectum, biopsies: Ulcerative pancolitis with activity from 50 cm to rectum. Inflammatory pseudopolyp at 50 cm. Negative for dysplasia.     "                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
##  [13] "A-C. Colon, 60-50 cm, 50-40 cm, 40-30 cm, biopsies: Inactive ulcerative colitis. Negative for dysplasia.   D, E. Colon, 0-30 cm, rectum, biopsies: Active ulcerative colitis. Negative for dysplasia.     "                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
##  [14] "A-F. Colon, surveillance biopsies: Quiescent ulcerative pancolitis. Negative for dysplasia.     "                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
##  [15] "A, C, D, E. Colon, as designated, biopsies: Chronic colitis. Negative for dysplasia.   B. Transverse colon, biopsy: Chronic colitis with granuloma. See comment.     "                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
##  [16] "A. Right colon, biopsy: No significant abnormality. Negative for dysplasia.   B. Transverse colon, biopsy: Quiescent ulcerative colitis. Negative for dysplasia.   C. Left colon, biopsy: No significant abnormality. Negative for dysplasia.   D. Sigmoid colon, biopsy: Quiescent ulcerative colitis. Negative for dysplasia.   E. Rectum, biopsy: No significant abnormality. Negative for dysplasia.     "                                                                                                                                                                                                                                                                                                                                 
##  [17] "A. Rectum, biopsy: No significant abnormality. Negative for dysplasia.     "                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
##  [18] "A-C. Colon, as designated, biopsies: No significant abnormality, negative for dysplasia.   D. Colon, sigmoid, biopsy: Chronic colitis, negative for dysplasia.   E. Rectum, biopsy: No significant abnormality, negative for dysplasia.     "                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
##  [19] "A. J pouch, biopsy: Pouchitis.   B. Rectum, biopsy: Active ulcerative colitis. Negative for dysplasia.     "                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
##  [20] "A. Afferent limb, biopsy: Active chronic enteritis. Negative for dysplasia.   B. J-pouch, biopsy: Ulcer.   C. Pouch pseudopolyps, biopsy: Inflammatory pseudopolyp.   D. Rectum, biopsy: Small-bowel type mucosa with active inflammation. No definitive colonic mucosa. Negative for dysplasia.     "                                                                                                                                                                                                                                                                                                                                                                                                                                         
##  [21] "A. Appendiceal orifice, biopsy: Sessile serrated adenoma.   B. Rectum, biopsy: Hyperplastic polyp(s).     "                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
##  [22] "A. Transverse colon, biopsy: No significant abnormality.   B. Rectum, biopsy: Active ulcerative colitis. Negative for dysplasia.     "                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
##  [23] "A-E. Colon and rectum, see sites specified below, biopsies: No significant abnormality. Negative for dysplasia.     "                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
##  [24] "A. Rectum, polypectomy site, biopsy: Adenoma.   B. Colon, random polyp site, biopsy: Benign mucosal polyp.     "                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
##  [25] "A. J pouch, biopsy: No significant abnormality.   B. Pouch inlet ulcer, biopsy: Ulcer. Negative for dysplasia.   C. Rectal cuff, biopsy: Unremarkable small bowel-type mucosa. No definitive colonic mucosa identified. Negative for dysplasia.     "                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
##  [26] "A, C. Colon, right and left, biopsies: Chronic colitis. Negative for dysplasia.   B, D. Transverse colon and rectum, biopsies: No significant abnormality. Negative for dysplasia.     "                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
##  [27] "A-E. Colon, surveillance biopsies: Quiescent chronic colitis in transverse colon through rectum. Negative for dysplasia.     "                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
##  [28] "A-D. Terminal ileum and Colon, see sites specified below, biopsies: No significant abnormality. Negative for dysplasia.   E. Rectum, biopsy: Active chronic colitis, identical to ulcerative colitis. Negative for dysplasia.     "                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
##  [29] "A-D, F. Colon, see sites specified below, biopsies: Chronic colitis. Negative for dysplasia.   E. Rectum, proximal, biopsy: Active chronic colitis, favor ulcerative colitis. Negative for dysplasia.     "                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
##  [30] "A. Cecum, polyps, biopsy: Hyperplastic polyps.   B. Right colon, biopsies: No significant abnormality. Negative for dysplasia.   C. Descending colon, polyps, biopsy: Hyperplastic polyps.   D. Left colon, biopsies: Hyperplastic polyps. Negative for dysplasia.   E. \"Large polyps 30 cm\", biopsy: Hyperplastic polyps.   F. \"Normal mucosa 30 cm\", biopsy: No significant abnormality. Negative for dysplasia.   G. Sigmoid colon, flat polyps, biopsy: Sessile serrated adenoma and hyperplastic polyp.   H. Sigmoid colon, normal, biopsy: No significant abnormality. Negative for dysplasia.   I. Rectum, biopsy: Hyperplastic polyp and fragments of colonic mucosa with no significant abnormality. Negative for dysplasia.     "
##  [31] "A-E. Colon, surveillance biopsies: Quiescent ulcerative colitis involving descending and sigmoid colon. Negative for dysplasia.     "                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
##  [32] "A-C. Descending colon through rectum, biopsies: Active chronic colitis identical to ulcerative colitis, involving descending colon through rectum. Negative for dysplasia.     "                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
##  [33] "A. Terminal ileum, biopsy: No significant abnormality.   B. Right colon, biopsies: No significant abnormality.   C. Left colon, biopsies: No significant abnormality.     "                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
##  [34] "A-F. Colon, surveillance biopsies: Patchy active ulcerative colitis involving descending colon through rectum. Inflammatory pseudopolyp in descending colon. No residual polyp at tattoo site. Negative for dysplasia.     "                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
##  [35] "A. Right colon, biopsies: No significant abnormality.   B. Hepatic flexure, biopsy: No significant abnormality.   C. Transverse colon, biopsy: No significant abnormality.   D. Left colon, biopsies: One hyperplastic polyp. Otherwise, no significant abnormality.   E. Sigmoid colon, biopsy: No significant abnormality.   F. Rectum, biopsy: Focal mild active chronic colitis. Negative for dysplasia.   G. Proximal rectal polyp, biopsy: Benign mucosal polyp.  Negative for dysplasia.     "                                                                                                                                                                                                                                          
##  [36] "A. Ascending colon, biopsy: No significant abnormality.   B. Transverse colon, biopsy: No significant abnormality.   C. Descending colon, biopsy: No significant abnormality.   D. Rectosigmoid colon, biopsy: Quiescent colitis. Negative for dysplasia.     "                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
##  [37] "A-C. Colon, descending through rectum, biopsies: Diffuse chronic colitis in an intensely active phase involving all the biopsies, identical to ulcerative colitis. See Comment.     "                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
##  [38] "A. Pouch, biopsy: Ulcerating pouchitis.   B. Cuff, biopsy: Predominantly small-bowel type mucosa with small fragment of colonic-type mucosa with active chronic colitis, negative for dysplasia.     "                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
##  [39] "A-E. Colon, surveillance biopsies: No significant abnormality. Negative for dysplasia.     "                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
##  [40] "A-E. Colon, surveillance biopsies: Adenoma in the cecum. Paneth cell metaplasia in the rectum and sigmoid indicating previous injury. Otherwise no significant abnormality and no dysplasia.     "                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
##  [41] "A. Terminal ileum, biopsy: Active chronic enteritis, consistent with backwash ileitis. Negative for dysplasia.   B. Right colon, biopsies: Active ulcerative colitis. Negative for dysplasia.   C. Right colon, polyps, biopsy: Inflammatory pseudopolyps in a background of active ulcerative colitis. Negative for dysplasia.   D. Left colon, biopsies: Quiescent ulcerative colitis. Negative for dysplasia.   E. Transverse colon, biopsy: Active ulcerative colitis. Negative for dysplasia.   F. Transverse colon, polyp, biopsy: Polypoid low-grade dysplasia, identical to a sporadic adenoma. Background colonic mucosa with active ulcerative colitis.     "                                                                        
##  [42] "A. Terminal ileum, biopsy: No significant abnormality.   B-F. Colon, surveillance biopsies: Quiescent ulcerative pancolitis with inflammatory pseudopolyps in sigmoid and transverse colon. Negative for dysplasia.     "                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
##  [43] "A-E. Right colon through rectum, surveillance biopsies: Largely quiescent colitis, with focal activity in the sigmoid colon. Negative for dysplasia.     "                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
##  [44] "A. Transverse colon, biopsy: Benign mucosal polyp.   B. Descending colon, biopsy: Hyperplastic polyp.   C. Rectum, biopsy: Hyperplastic polyp with prolapse changes.     "                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
##  [45] "A. Cecum, biopsy: No significant abnormality.   B. Ascending colon, biopsy: No significant abnormality.   C. Transverse colon, biopsy: No significant abnormality.   D. Descending colon, biopsy: No significant abnormality.   E. Sigmoid colon, biopsy: No significant abnormality.   F. Rectum, biopsy: Quiescent colitis. Negative for dysplasia.     "                                                                                                                                                                                                                                                                                                                                                                                    
##  [46] "A-D. Terminal ileum and colon, surveillance biopsies: Marked active ulcerative colitis in the sigmoid colon with mild activity in the right and left colon. Negative for dysplasia. Terminal ileum with no significant abnormality.     "                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
##  [47] "A. Ileum, biopsies: Patchy active ileitis. See comment.   B. Rectum, biopsy: Quiescent chronic colitis. Negative for dysplasia.     "                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
##  [48] "A-F. Colon and rectum, surveillance biopsies: Active ulcerative pancolitis. Negative for dysplasia.     "                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
##  [49] "A-E. Colon and rectum, surveillance biopsies: Healed pseudopolyps, otherwise no significant abnormality.     "                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
##  [50] "A-F. Terminal ileum, colon and rectum, surveillance biopsies: Minimally active ulcerative pancolitis. Negative for dysplasia. Terminal ileum with no significant abnormality.     "                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
##  [51] "A-E. Colon and rectum, surveillance biopsies: Quiescent ulcerative colitis. Single focus of low-grade dysplasia in the transverse colon, resembling a small sporadic adenoma.     "                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
##  [52] "A-E. Terminal ileum through rectum, surveillance biopsies: Quiescent left-sided ulcerative colitis, negative for dysplasia. Unremarkable terminal ileum.     "                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
##  [53] "A-B. Colon, 50-40 cm, biopsy: Active ulcerative colitis. Negative for dysplasia.   C. Rectum, biopsy: Patchy active ulcerative colitis. Negative for dysplasia.     "                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
##  [54] "A. Jejunum, biopsy: No significant abnormality.   B. Ileo-ileal anastomosis: No significant abnormality.   C. Ileal ulcer, biopsy: Ulcer and reactive mucosa. Negative for dysplasia. CMV immunostain is negative.   D. \"Nodular mucosa\", biopsy: Architectural changes. Negative for dysplasia.     "                                                                                                                                                                                                                                                                                                                                                                                                                                       
##  [55] "A. Sigmoid, 0-40, biopsies: Chronic active colitis. Negative for dysplasia.     "                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
##  [56] "A. Transverse colon, biopsy: Inactive chronic colitis; negative for dysplasia.   B. Descending colon, 40cm, biopsy: Chronic, active colitis; negative for dysplasia.   C. Sigmoid colon, biopsy: Chronic, active colitis; negative for dysplasia.   D. Rectum, biopsy: Chronic, active colitis; negative for dysplasia.     "                                                                                                                                                                                                                                                                                                                                                                                                                  
##  [57] "A, B. J-pouch and Ileum, biopsies: Features of chronic enteritis and mild active inflammation. Negative for dysplasia.   C. Rectal cuff, biopsy: Chronic active colitis. Negative for dysplasia.     "                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
##  [58] "A. Transverse colon, biopsy:  Chronic active colitis with low grade dysplasia. See comment.     "                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
##  [59] "A. Right colon, biopsy: Chronic, active colitis; negative for dysplasia.   B. Left colon, biopsy: Chronic, active colitis; negative for dysplasia.   C. Rectum, biopsy: Chronic, active colitis; negative for dysplasia.     "                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
##  [60] "A. Descending colon, biopsy: Chronic active colitis. Negative for dysplasia.     "                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
##  [61] NA                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
##  [62] "Transverse colon, biopsy (S18-688; 01/21/2018): Fragments of villiform low-grade dysplasia in a background of active chronic colitis.     "                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
##  [63] "A-E. Colon, pancolonic surveillance biopsies: No significant abnormality. Negative for dysplasia.     "                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
##  [64] "A-H. Colon, surveillance biopsies: Ulcerative colitis involving descending colon through rectum, with patchy activity in descending and sigmoid colon. Hyperplastic polyp in rectum. Negative for dysplasia.     "                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
##  [65] "A-G. Colon, pancolonic surveillance biopsies: Quiescent chronic colitis involving the distal transverse colon through rectum. No significant abnormality in the cecum and proximal transverse colon. One sessile serrated adenoma in the transverse colon. Otherwise, negative for dysplasia.     "                                                                                                                                                                                                                                                                                                                                                                                                                                            
##  [66] "A-E. Colon, see sites below, biopsies: No significant abnormality. Negative for dysplasia.     "                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
##  [67] "A-D. Colon, surveillance biopsies: No significant abnormality. Negative for dysplasia.     "                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
##  [68] "A-E. Colon, pancolonic surveillance biopsies: Quiescent chronic colitis. Negative for dysplasia.     "                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
##  [69] "A-B. Colon, cecum, biopsies: Ulcerative colitis-like changes. Negative for dysplasia.   C-F. Colon, surveillance biopsies: No significant abnormality. Negative for dysplasia.     "                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
##  [70] "A-C) Colon as designated, and rectum, biopsies: Quiescent ulcerative colitis, negative for dysplasia.     "                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
##  [71] "A-D. Colon, as designated, biopsies: Mild lymphocytosis mostly affecting right, left, and transverse colon. Negative for dysplasia.     "                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
##  [72] "A-E. Colon, surveillance biopsies: Ulcerative pancolitis with patchy activity in descending colon through rectum. Negative for dysplasia.     "                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
##  [73] "A. Colon, biopsies: No significant abnormality.     "                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
##  [74] "A-F. Colon, surveillance biopsies: Predominantly quiescent left-sided ulcerative colitis with patchy activity in sigmoid colon and rectum. Inflammatory pseudopolyps in rectosigmoid colon. Negative for dysplasia. See comment.     "                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
##  [75] "A-F. Colon, surveillance biopsies: Ulcerative colitis with inflammatory pseudopolyps in the transverse and sigmoid colon. Negative for dysplasia.     "                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
##  [76] "A. Colon, presumably surveillance biopsies (GRB-18-000724, 1/8/18): High-grade dysplasia, suspicious for invasive adenocarcinoma, arising in quiescent patchy chronic pancolitis, presumably ulcerative pancolitis. See Comment.     "                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
##  [77] "A. Stomach, biopsy: Superficial gastric mucosa with no significant abnormality.   B. Duodenum, biopsy: Brunner gland hyperplasia.   C. Terminal ileum, biopsy: No significant abnormality.   D-I. Colon, see sites below, biopsies: Histologic findings identical to collagenous colitis. Inflammatory pseudopolyps. Negative for dysplasia. See comment.     "                                                                                                                                                                                                                                                                                                                                                                                
##  [78] "A, B) Colon, as designated, biopsies: No significant abnormality, negative for dysplasia.   C) Left colon, biopsy: Quiescent inflammatory bowel disease compatible with history of ulcerative colitis, negative for dysplasia.     "                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
##  [79] "A, B. Colon, as designated, biopsies: Chronic colitis with ulcer, compatible with history of Crohn's disease. Negative for dysplasia.   C. Rectum, biopsy: No significant abnormality, negative for dysplasia.     "                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
##  [80] "A. Terminal ileum, biopsies: No significant abnormality.   B-F. Colon, surveillance biopsies: Ulcerative colitis currently involving the descending colon through rectum. Otherwise, no significant abnormality. Negative for dysplasia.     "                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
##  [81] "A. Rectosigmoid colon, biopsy: Patchy active chronic colitis. Negative for dysplasia.     "                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
##  [82] "A-D. Colon, surveillance biopsies: Quiescent ulcerative colitis, currently diffusely involving the right colon with only focal Paneth cell metaplasia in the rectosigmoid colon and otherwise complete healing on the left side. Negative for dysplasia.     "                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
##  [83] "A. Afferent limb, biopsy: Focal active enteritis.   B. Pouch inlet, biopsy: Active enteritis.   C. J pouch, biopsy: Active enteritis. Adenovirus immunohistochemistry is negative.   D. Rectal cuff, biopsy: Minute strips of colonic mucosa with active colitis, negative for dysplasia.     "                                                                                                                                                                                                                                                                                                                                                                                                                                                
##  [84] "A. Stomach, biopsies: Mild chronic gastritis of the type sometimes seen in patients with ulcerative colitis.   B-F. Colon, surveillance biopsies: Ulcerative pancolitis. Negative for dysplasia.     "                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
##  [85] "A-C. Colon, biopsies: Ulcerative colitis, currently involving the distal transverse colon. Negative for dysplasia.     "                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
##  [86] "A. Terminal ileum, biopsies: No significant abnormality.   B-O. Colon, surveillance biopsies: Ulcerative pancolitis.  Low-grade dysplasia in the cecum at 90 cm (part B) and in the area of stricture at 10 cm (part O).. Epithelial changes indefinite for dysplasia in the \"mass\" at 30 cm (part L) and in the \"rectal lesion\" biopsy (part N).  No dysplasia elsewhere. See comment.     "                                                                                                                                                                                                                                                                                                                                              
##  [87] "A-F. Colon, cecum through rectum, biopsies: Quiescent ulcerative colitis with inflammatory pseudopolyp in transverse colon, negative for dysplasia.     "                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
##  [88] "A. Ileum, biopsy: No significant abnormality.   B. Anastomosis, biopsy: Ulcer and small bowel mucosa with active chronic enteritis, likely anastomotic change.   C. Pouch, biopsy: Active enteritis and ulcer, likely pouchitis.   D. Cuff, biopsy: Quiescent ulcerative colitis, negative for dysplasia.     "                                                                                                                                                                                                                                                                                                                                                                                                                                
##  [89] "A. Terminal ileum, biopsy: No significant abnormality.   B-F. Colon, surveillance biopsies: Ulcerative colitis with inflammatory pseudopolyps, currently involving the left colon and rectosigmoid colon. Otherwise, no significant abnormality. Negative for dysplasia.     "                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
##  [90] "A. Colon, resection: Ulcerative pancolitis with two invasive adenocarcinomas, one in the ascending colon extending into muscularis propria and one in the transverse extending into pericolic adipose tissue. Multifocal polypoid dysplasia in the ascending and transverse colon. Margins negative. Twenty seven lymph nodes, negative for carcinoma (0/27). See templates and comment.     "                                                                                                                                                                                                                                                                                                                                                 
##  [91] "A. Colon, biopsies (DHS-18-111, 1/10/18): Superficially invasive adenocarcinoma arising from the base of a traditional serrated adenoma with cytologic high-grade dysplasia at 25 cm, and adenomas in the right and sigmoid colon. No significant abnormality in the terminal ileum, transverse and left colon and rectum. See Comment.     "                                                                                                                                                                                                                                                                                                                                                                                                  
##  [92] "A-G. Colon, as designated, biopsies: Quiescent ulcerative colitis with focus indefinite for dysplasia in the cecum, and polypoid  low grade dysplasia  in transverse colon (parts C and D designated \"nodular patch transverse colon\" and \"transverse colon\").     "                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
##  [93] "A-C. Colon, surveillance biopsies: Active ulcerative colitis, currently limited to the rectum. Otherwise, no significant abnormality. Negative for dysplasia.     "                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
##  [94] "A. Colon, sigmoid, biopsies: Quiescent chronic colitis. Negative for dysplasia.   B. Rectum, biopsies: Chronic active proctitis. Negative for dysplasia.     "                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
##  [95] "A. Terminal ileum, biopsies: No significant abnormality.   B-D. Colon, surveillance biopsies: Benign mucosal polyp in the descending colon. Otherwise, no significant abnormality. See comment.     "                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
##  [96] "A-F. Colon, surveillance biopsies: Polypoid low-grade dysplasia identical to adenoma in sigmoid colon. Hyperplastic polyp in the rectum. Otherwise, no significant abnormality. Negative for dysplasia.     "                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
##  [97] "A-D. Colon, surveillance biopsies: Quiescent left-sided chronic colitis with focal activity in right colon.  Negative for dysplasia.     "                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
##  [98] "A. Colon, right, biopsies: No significant abnormality. Negative for dysplasia.   B. Colon, transverse, biopsies: No significant abnormality. Negative for dysplasia.   C. Colon, left, biopsies: Focally active colitis. Negative for dysplasia.   D. Colon, sigmoid and rectum, biopsies: No significant abnormality. Negative for dysplasia.     "                                                                                                                                                                                                                                                                                                                                                                                           
##  [99] "A-B. Descending and sigmoid colon, biopsies: Active ulcerative colitis. Negative for dysplasia.   C. Colonic stricture, biopsy: Low-grade dysplasia in a background of ulcerative colitis. See comment.   D. Rectum, biopsy: Active ulcerative colitis. Negative for dysplasia.     "                                                                                                                                                                                                                                                                                                                                                                                                                                                          
## [100] "A. Distal esophagus, biopsies: - Unremarkable esophageal squamous mucosa. B. Gastric antrum and body, biopsies: - Focally active gastritis. C. Duodenum, biopsies: - Unremarkable duodenal mucosa. D. Terminal ileum, biopsies: - Mild chronic active ileitis. E. Cecum and ascending, biopsies: - Diffuse, moderately active chronic colitis. F. Transverse and descending, biopsies: - Diffuse, moderately active chronic colitis. G. Sigmoid and rectum, biopsies: - Diffuse, moderately active chronic colitis.     "
```

### Gotchas
#### escaping stuff like \n for newline: \\n, \\t
#### greek or other odd characters with unicode
R> "\u00b5M"
[1] "M"
R> "\u03b1"
[1] ""
R> "\u03b2"
[1] ""
R> "\u03b3"
[1] ""

#### wildcards like .
#### \s for whitespace, \d for digit, \w for word

### from stringr-vignettes/regular-expressions.html
{2} for repetition
. for wild card
? 0 or 1
* 0 or more
+ for one or more
[abc] any of a,b,c
[^abc] not a,b,c
(abd|def) abc or def
repeat
### try on Biofire output

## RVerbalExpressions Package Website
[RVE](https://rverbalexpressions.netlify.com)


```r
doc_vec <- c("Pathologist Annie Jones MD", " Pathologist Ralph Boston MD", "Pathologist Carla Curtin MD", "Pathologist Dave Don Domino MD")

pattern <- rx() %>% 
  rx_find("Pathologist") %>% 
  rx_space() %>% 
  rx_word() %>% 
  rx_space() %>% 
  rx_word() %>% 
  rx_space() %>% 
  rx_find('MD') 
pattern
```

```
## [1] "(Pathologist) \\w+ \\w+ (MD)"
```

```r
pattern2 <- rx() %>% 
  rx_find("Pathologist") %>% 
  rx_anything()%>% 
  rx_find('MD') 

str_view(string = doc_vec, pattern = pattern2)
```

<!--html_preserve--><div id="htmlwidget-b3642939027c1f5feb6a" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-b3642939027c1f5feb6a">{"x":{"html":"<ul>\n  <li><span class='match'>Pathologist Annie Jones MD<\/span><\/li>\n  <li> <span class='match'>Pathologist Ralph Boston MD<\/span><\/li>\n  <li><span class='match'>Pathologist Carla Curtin MD<\/span><\/li>\n  <li><span class='match'>Pathologist Dave Don Domino MD<\/span><\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script><!--/html_preserve-->
